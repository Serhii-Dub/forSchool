<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>3D місто для учнів</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <style>
    body { margin: 0; overflow: hidden; }
    #speed-panel {
      position: absolute; top: 20px; right: 30px; z-index: 100;
      background: rgba(30,30,30,0.87); padding: 12px 18px; border-radius: 13px;
      font-size: 1.1em; color: #fff; font-family: Segoe UI,Arial,sans-serif;
      user-select: none; box-shadow: 0 2px 8px #0006;
    }
    #speed-panel button {
      font-size: 1.1em; margin: 0 3px; border-radius: 7px; border: none;
      background: #45b5c4; color: #fff; padding: 3px 14px; cursor: pointer;
      transition: background 0.2s;
    }
    #speed-panel button.active {
      background: #ffab00;
      color: #222;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div id="speed-panel">
    <b>Швидкість:</b>
    <button data-speed="1" class="active">x1</button>
    <button data-speed="2">x2</button>
    <button data-speed="4">x4</button>
    <span style="margin-left:20px;font-size:0.92em;color:#ccc;">WASD — ходити, Shift — бігти</span>
  </div>
  <a-scene background="color: #23252a" shadow="type: pcfsoft" embedded>
    <a-assets timeout="20000">
      <a-asset-item id="cityModel" src="city/source/city.glb"></a-asset-item>
    </a-assets>
    <a-entity gltf-model="#cityModel" position="0 0 0"></a-entity>
    <a-entity light="type: ambient; color: #eef; intensity: 1"></a-entity>
    <a-entity light="type: directional; intensity: 2.2" position="50 80 40"></a-entity>
    <a-entity
      id="player"
      camera
      wasd-controls="acceleration: 40"
      position="0 3 8"
      look-controls="pointerLockEnabled: true"
    ></a-entity>
  </a-scene>
  <script>
    // Тільки швидкість руху + біг (Shift)
    const speeds = {1: 40, 2: 80, 4: 160};
    let currentSpeed = 1;
    let running = false;
    const player = document.getElementById('player');
    const buttons = document.querySelectorAll('#speed-panel button');

    buttons.forEach(btn => {
      btn.addEventListener('click', () => {
        buttons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentSpeed = Number(btn.dataset.speed);
        player.setAttribute('wasd-controls', 'acceleration', speeds[currentSpeed] * (running ? 2 : 1));
      });
    });

    window.addEventListener('keydown', e => {
      if ((e.code === 'ShiftLeft' || e.code === 'ShiftRight') && !running) {
        running = true;
        player.setAttribute('wasd-controls', 'acceleration', speeds[currentSpeed] * 2);
      }
    });
    window.addEventListener('keyup', e => {
      if (e.code === 'ShiftLeft' || e.code === 'ShiftRight') {
        running = false;
        player.setAttribute('wasd-controls', 'acceleration', speeds[currentSpeed]);
      }
    });

    window.addEventListener('DOMContentLoaded', () => {
      player.setAttribute('wasd-controls', 'acceleration', speeds[currentSpeed]);
    });
  </script>
</body>
</html>
